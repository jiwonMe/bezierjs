"use strict";(()=>{var{abs:O,min:ut,max:ft,cos:R,sin:P,acos:$,atan2:F,sqrt:E,pow:k}=Math;function G(e){return e<0?-k(-e,1/3):k(e,1/3)}var Q=Math.PI,V=2*Q,j=Q/2,mt=1e-6,H=Number.MAX_SAFE_INTEGER||9007199254740991,tt=Number.MIN_SAFE_INTEGER||-9007199254740991,yt={x:0,y:0,z:0},W=[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],et=[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872];var at=function(e,t){let n=t(e),r=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(r+=n.z*n.z),E(r)},X=function(e,t,n){if(e===0)return t[0].t=0,t[0];let r=t.length-1;if(e===1)return t[r].t=1,t[r];let s=1-e,i=t;if(r===0)return t[0].t=e,t[0];if(r===1){let c={x:s*i[0].x+e*i[1].x,y:s*i[0].y+e*i[1].y,t:e};return n&&(c.z=s*i[0].z+e*i[1].z),c}if(r<4){let c=s*s,u=e*e,l,f,a,p=0;r===2?(i=[i[0],i[1],i[2],yt],l=c,f=s*e*2,a=u):r===3&&(l=c*s,f=c*e*3,a=s*u*3,p=e*u);let m={x:l*i[0].x+f*i[1].x+a*i[2].x+p*i[3].x,y:l*i[0].y+f*i[1].y+a*i[2].y+p*i[3].y,t:e};return n&&(m.z=l*i[0].z+f*i[1].z+a*i[2].z+p*i[3].z),m}let o=JSON.parse(JSON.stringify(t));for(;o.length>1;){for(let c=0;c<o.length-1;c++)o[c]={x:o[c].x+(o[c+1].x-o[c].x)*e,y:o[c].y+(o[c+1].y-o[c].y)*e},typeof o[c].z<"u"&&(o[c].z=o[c].z+(o[c+1].z-o[c].z)*e);o.splice(o.length-1,1)}return o[0].t=e,o[0]},dt=function(e,t,n,r){let s=1-e,i=n,o=t,c=i[0],u=i[1],l=i[2],f=i[3],a;if(c*=s,u*=e,o.length===2)return a=c+u,{x:(c*o[0].x+u*o[1].x)/a,y:(c*o[0].y+u*o[1].y)/a,z:r?(c*o[0].z+u*o[1].z)/a:!1,t:e};if(c*=s,u*=2*s,l*=e*e,o.length===3)return a=c+u+l,{x:(c*o[0].x+u*o[1].x+l*o[2].x)/a,y:(c*o[0].y+u*o[1].y+l*o[2].y)/a,z:r?(c*o[0].z+u*o[1].z+l*o[2].z)/a:!1,t:e};if(c*=s,u*=1.5*s,l*=3*s,f*=e*e*e,o.length===4)return a=c+u+l+f,{x:(c*o[0].x+u*o[1].x+l*o[2].x+f*o[3].x)/a,y:(c*o[0].y+u*o[1].y+l*o[2].y+f*o[3].y)/a,z:r?(c*o[0].z+u*o[1].z+l*o[2].z+f*o[3].z)/a:!1,t:e}},gt=function(e,t){let n=[];for(let r=e,s=r.length,i=s-1;s>1;s--,i--){let o=[];for(let c=0,u;c<i;c++)u={x:i*(r[c+1].x-r[c].x),y:i*(r[c+1].y-r[c].y)},t&&(u.z=i*(r[c+1].z-r[c].z)),o.push(u);n.push(o),r=o}return n},zt=function(e){let n=W.length,r=0;for(let s=0,i;s<n;s++)i=.5*W[s]+.5,r+=et[s]*at(i,e);return .5*r};var _t=function(e,t,n){return t<=e&&e<=n||T(e,t)||T(e,n)},T=function(e,t,n){return O(e-t)<=(n||mt)},vt=function(e,t,n,r,s){let i=n-t,o=s-r,c=e-t,u=c/i;return r+o*u},wt=function(e,t,n){let r={x:t.x+e*(n.x-t.x),y:t.y+e*(n.y-t.y)};return t.z!==void 0&&n.z!==void 0&&(r.z=t.z+e*(n.z-t.z)),r},lt=function(e){let t=e.x+"/"+e.y;return typeof e.z<"u"&&(t+="/"+e.z),t},Et=function(e){return"["+e.map(lt).join(", ")+"]"},At=function(e){return JSON.parse(JSON.stringify(e))},Ot=function(e,t,n){let r=t.x-e.x,s=t.y-e.y,i=n.x-e.x,o=n.y-e.y,c=r*o-s*i,u=r*i+s*o;return F(c,u)},Ct=function(e,t){let n=""+e,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+t))},Z=function(e,t){let n=e.x-t.x,r=e.y-t.y;return E(n*n+r*r)},bt=function(e,t){let n=k(2,63),r,s;return e.forEach(function(i,o){s=Z(t,i),s<n&&(n=s,r=o)}),{mdist:n,mpos:r}},Mt=function(e,t){if(t!==2&&t!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;let n=k(e,t)+k(1-e,t),r=n-1;return O(r/n)},kt=function(e,t){if(t!==2&&t!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;let n=k(1-e,t),r=k(e,t)+n;return n/r},B=function(e,t,n,r,s,i,o,c){let u=(e*r-t*n)*(s-o)-(e-n)*(s*c-i*o),l=(e*r-t*n)*(i-c)-(t-r)*(s*c-i*o),f=(e-n)*(i-c)-(t-r)*(s-o);return f==0?!1:{x:u/f,y:l/f}},ht=function(e,t,n,r){let s=e.x,i=e.y,o=t.x,c=t.y,u=n.x,l=n.y,f=r.x,a=r.y;return B(s,i,o,c,u,l,f,a)},It=function(e,t){return ht(e,e.c,t,t.c)},Y=function(e,t){let n=t.p1.x,r=t.p1.y,s=-F(t.p2.y-r,t.p2.x-n),i=function(o){return{x:(o.x-n)*R(s)-(o.y-r)*P(s),y:(o.x-n)*P(s)+(o.y-r)*R(s)}};return e.map(i)},Tt=function(e,t){return e-t};var Nt=function(e,t){t=t||{p1:{x:0,y:0},p2:{x:1,y:0}};let n=e.length-1,r=Y(e,t),s=function(x){return 0<=x&&x<=1};if(n===2){let x=r[0].y,z=r[1].y,v=r[2].y,M=x-2*z+v;if(M!==0){let N=-E(z*z-x*v),q=-x+z,K=-(N+q)/M,S=-(-N+q)/M;return[K,S].filter(s)}else if(z!==v&&M===0)return[(2*z-v)/(2*z-2*v)].filter(s);return[]}let i=r[0].y,o=r[1].y,c=r[2].y,u=r[3].y,l=-i+3*o-3*c+u,f=3*i-6*o+3*c,a=-3*i+3*o,p=i;if(T(l,0)){if(T(f,0))return T(a,0)?[]:[-p/a].filter(s);let x=E(a*a-4*f*p),z=2*f;return[(x-a)/z,(-a-x)/z].filter(s)}f/=l,a/=l,p/=l;let m=(3*a-f*f)/3,g=m/3,A=(2*f*f*f-9*f*a+27*p)/27,C=A/2,w=C*C+g*g*g,I,_,y,d,b;if(w<0){let x=-m/3,z=x*x*x,v=E(z),M=-A/(2*v),N=M<-1?-1:M>1?1:M,q=$(N),K=G(v),S=2*K;return y=S*(V/3)-f/3,d=S*((q+V)/3)-f/3,b=S*((q+2*V)/3)-f/3,[y,d,b].filter(s)}else{if(w===0)return I=C<0?G(-C):-G(C),y=2*I-f/3,d=-I-f/3,[y,d].filter(s);{let x=E(w);return I=G(-C+x),_=G(C+x),[I-_-f/3].filter(s)}}},qt=function(e){if(e.length===3){let t=e[0],n=e[1],r=e[2],s=t-2*n+r;if(s!==0){let i=-E(n*n-t*r),o=-t+n,c=-(i+o)/s,u=-(-i+o)/s;return[c,u]}else if(n!==r&&s===0)return[(2*n-r)/(2*(n-r))];return[]}if(e.length===2){let t=e[0],n=e[1];return t!==n?[t/(t-n)]:[]}return[]},nt=function(e,t,n,r,s){let i,o,c,u,l=0,f=0,a=X(e,t),p=X(e,n),m=a.x*a.x+a.y*a.y;if(r?(i=E(k(a.y*p.z-p.y*a.z,2)+k(a.z*p.x-p.z*a.x,2)+k(a.x*p.y-p.x*a.y,2)),o=k(m+a.z*a.z,3/2)):(i=a.x*p.y-a.y*p.x,o=k(m,3/2)),i===0||o===0)return{k:0,r:0};if(l=i/o,f=o/i,!s){let g=nt(e-.001,t,n,r,!0).k,A=nt(e+.001,t,n,r,!0).k;u=(A-l+(l-g))/2,c=(O(A-l)+O(l-g))/2}return{k:l,r:f,dk:u,adk:c}},Rt=function(e){if(e.length<4)return[];let t=Y(e,{p1:e[0],p2:e.slice(-1)[0]}),n=t[2].x*t[1].y,r=t[3].x*t[1].y,s=t[1].x*t[2].y,i=t[3].x*t[2].y,o=18*(-3*n+2*r+3*s-i),c=18*(3*n-r-3*s),u=18*(s-n);if(T(o,0)){if(!T(c,0)){let p=-u/c;if(0<=p&&p<=1)return[p]}return[]}let l=2*o;if(T(l,0))return[];let f=c*c-4*o*u;if(f<0)return[];let a=Math.sqrt(f);return[(a-c)/l,-(c+a)/l].filter(function(p){return 0<=p&&p<=1})};var rt=function(e,t){let n=["x","y"],r=n.length;for(let s=0,i,o,c,u;s<r;s++)if(i=n[s],o=e[i].mid,c=t[i].mid,u=(e[i].size+t[i].size)/2,O(o-c)>=u)return!1;return!0},Pt=function(e,t){t.x.min<e.x.min&&(e.x.min=t.x.min),t.y.min<e.y.min&&(e.y.min=t.y.min),t.z&&t.z.min<e.z.min&&(e.z.min=t.z.min),t.x.max>e.x.max&&(e.x.max=t.x.max),t.y.max>e.y.max&&(e.y.max=t.y.max),t.z&&t.z.max>e.z.max&&(e.z.max=t.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pt=function(e,t,n){let r=e.bbox(),s=t.bbox(),i=1e5,o=n||.5;if(r.x.size+r.y.size<o&&s.x.size+s.y.size<o)return[(i*(e._t1+e._t2)/2|0)/i+"/"+(i*(t._t1+t._t2)/2|0)/i];let c=e.split(.5),u=t.split(.5),l=[{left:c.left,right:u.left},{left:c.left,right:u.right},{left:c.right,right:u.right},{left:c.right,right:u.left}];l=l.filter(function(a){return rt(a.left.bbox(),a.right.bbox())});let f=[];return l.length===0||(l.forEach(function(a){f=f.concat(pt(a.left,a.right,o))}),f=f.filter(function(a,p){return f.indexOf(a)===p})),f},jt=function(e,t,n){let r=t.x-e.x,s=t.y-e.y,i=n.x-t.x,o=n.y-t.y,c=r*R(j)-s*P(j),u=r*P(j)+s*R(j),l=i*R(j)-o*P(j),f=i*P(j)+o*R(j),a=(e.x+t.x)/2,p=(e.y+t.y)/2,m=(t.x+n.x)/2,g=(t.y+n.y)/2,A=a+c,C=p+u,w=m+l,I=g+f,_=B(a,p,A,C,m,g,w,I),y=Z(_,e),d=F(e.y-_.y,e.x-_.x),b=F(t.y-_.y,t.x-_.x),x=F(n.y-_.y,n.x-_.x),z;return d<x?((d>b||b>x)&&(d+=V),d>x&&(z=x,x=d,d=z)):x<b&&b<d?(z=x,x=d,d=z):x+=V,_.s=d,_.e=x,_.r=y,_},it=function(e){let t=H,n=H,r=tt,s=tt;return e.forEach(function(i){let o=i.bbox();t>o.x.min&&(t=o.x.min),n>o.y.min&&(n=o.y.min),r<o.x.max&&(r=o.x.max),s<o.y.max&&(s=o.y.max)}),{x:{min:t,mid:(t+r)/2,max:r,size:r-t},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},st=function(e,t,n,r,s){if(!rt(t,r))return[];let i=[],o=[e.startcap,e.forward,e.back,e.endcap],c=[n.startcap,n.forward,n.back,n.endcap];return o.forEach(function(u){u.virtual||c.forEach(function(l){if(l.virtual)return;let f=u.intersects(l,s);f.length>0&&(f.c1=u,f.c2=l,f.s1=e,f.s2=n,i.push(f))})}),i},Ut=function(e,t,n){if(!n)return{min:0,max:0};let r=H,s=tt,i,o;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let c=0,u=n.length;c<u;c++)i=n[c],o=e.get(i),o[t]<r&&(r=o[t]),o[t]>s&&(s=o[t]);return{min:r,mid:(r+s)/2,max:s,size:s-r}};var xt=null;function Lt(e){xt=e}var ot=function(e,t){if(!xt)throw new Error("Bezier class not set. Call setBezierClass first.");return new xt(e.x,e.y,(e.x+t.x)/2,(e.y+t.y)/2,t.x,t.y)},Dt=function(e,t,n){let r=t.points.length,s=e.points.length,i=ot(t.points[r-1],e.points[0]),o=ot(e.points[s-1],t.points[0]),c={startcap:i,forward:e,back:t,endcap:o,bbox:it([i,e,t,o])};return c.intersections=function(u){return st(c,c.bbox,u,u.bbox,n)},c};var L=class extends Error{constructor(t,n,r={}){super(t),this.name="KirbError",this.code=n,this.details=r}},J={INVALID_CURVE:"INVALID_CURVE",INVALID_PARAMETER:"INVALID_PARAMETER",OUT_OF_RANGE:"OUT_OF_RANGE",COMPUTATION_FAILED:"COMPUTATION_FAILED",INVALID_INPUT:"INVALID_INPUT"};var h={Tvalues:W,Cvalues:et,arcfn:at,compute:X,computeWithRatios:dt,derive:gt,between:_t,approximately:T,length:zt,map:vt,lerp:wt,pointToString:lt,pointsToString:Et,copy:At,angle:Ot,round:Ct,dist:Z,closest:bt,abcratio:Mt,projectionratio:kt,lli8:B,lli4:ht,lli:It,makeline:ot,findbbox:it,shapeintersections:st,makeshape:Dt,getminmax:Ut,align:Y,roots:Nt,droots:qt,curvature:nt,inflections:Rt,bboxoverlap:rt,expandbox:Pt,pairiteration:pt,getccenter:jt,numberSort:Tt};var U=class{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(t){return h.pointsToString(t.points)}).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map(function(t){return t.length()}).reduce(function(t,n){return t+n})}curve(t){return this.curves[t]}bbox(){let t=this.curves;for(var n=t[0].bbox(),r=1;r<t.length;r++)h.expandbox(n,t[r].bbox());return n}offset(t){let n=[];return this.curves.forEach(function(r){n.push(...r.offset(t))}),new U(n)}};var ct=class{constructor(t){let n=t&&t.forEach?t:Array.from(arguments).slice(),r=!1;if(typeof n[0]=="object"){r=n.length;let m=[];n.forEach(function(g){["x","y","z"].forEach(function(A){typeof g[A]<"u"&&m.push(g[A])})}),n=m}let s=!1,i=n.length;if(r){if(r>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(i!==6&&i!==8&&i!==9&&i!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let o=this._3d=!s&&(i===9||i===12)||t&&t[0]&&typeof t[0].z<"u",c=this.points=[];for(let m=0,g=o?3:2;m<i;m+=g){var u={x:n[m],y:n[m+1]};o&&(u.z=n[m+2]),c.push(u)}let l=this.order=c.length-1,f=this.dims=["x","y"];o&&f.push("z"),this.dimlen=f.length;let a=h.align(c,{p1:c[0],p2:c[l]}),p=h.dist(c[0],c[l]);this._linear=a.reduce((m,g)=>m+O(g.y),0)<p/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,n,r,s=.5){if(s===0)return new this(n,n,r);if(s===1)return new this(t,n,n);let i=this.getABC(2,t,n,r,s);return new this(t,i.A,r)}static cubicFromPoints(t,n,r,s=.5,i){let o=this.getABC(3,t,n,r,s);typeof i>"u"&&(i=h.dist(n,o.C));let c=i*(1-s)/s,u=h.dist(t,r),l=(r.x-t.x)/u,f=(r.y-t.y)/u,a=i*l,p=i*f,m=c*l,g=c*f,A={x:n.x-a,y:n.y-p},C={x:n.x+m,y:n.y+g},w=o.A,I={x:w.x+(A.x-w.x)/(1-s),y:w.y+(A.y-w.y)/(1-s)},_={x:w.x+(C.x-w.x)/s,y:w.y+(C.y-w.y)/s},y={x:t.x+(I.x-t.x)/s,y:t.y+(I.y-t.y)/s},d={x:r.x+(_.x-r.x)/(1-s),y:r.y+(_.y-r.y)/(1-s)};return new this(t,y,d,r)}static getUtils(){return h}getUtils(){return h}static get PolyBezier(){return U}valueOf(){return this.toString()}toString(){return h.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let t=this.points,n=t[0].x,r=t[0].y,s=["M",n,r,this.order===2?"Q":"C"];for(let i=1,o=t.length;i<o;i++)s.push(t[i].x),s.push(t[i].y);return s.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){let t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map(function(t,n){return""+n+t.x+t.y+(t.z?t.z:0)}).join("")}update(){this._lut=[],this.dpoints=h.derive(this.points,this._3d),this.computedirection()}computedirection(){let t=this.points,n=h.angle(t[0],t[this.order],t[1]);this.clockwise=n>0}length(){return h.length(this.derivative.bind(this))}static getABC(t=2,n,r,s,i=.5){let o=h.projectionratio(i,t),c=1-o,u={x:o*n.x+c*s.x,y:o*n.y+c*s.y},l=h.abcratio(i,t);return{A:{x:r.x+(r.x-u.x)/l,y:r.y+(r.y-u.y)/l},B:r,C:u,S:n,E:s}}getABC(t,n){n=n||this.get(t);let r=this.points[0],s=this.points[this.order];return this.constructor.getABC(this.order,r,n,s,t)}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?h.computeWithRatios(t,this.points,this.ratios,this._3d):h.compute(t,this.points,this._3d,this.ratios)}raise(){let t=this.points,n=[t[0]],r=t.length;for(let s=1,i,o;s<r;s++)i=t[s],o=t[s-1],n[s]={x:(r-s)/r*i.x+s/r*o.x,y:(r-s)/r*i.y+s/r*o.y};return n[r]=t[r-1],new this.constructor(n)}derivative(t){return h.compute(t,this.dpoints[0],this._3d)}dderivative(t){return h.compute(t,this.dpoints[1],this._3d)}curvature(t){return h.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return h.inflections(this.points)}};var St={getLUT(e=100){if(this.verify(),this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let t=0,n,r;t<e;t++)r=t/(e-1),n=this.compute(r),n.t=r,this._lut.push(n);return this._lut},on(e,t=5){let n=this.findParameter(e,{tolerance:t});return n?n.t:!1},findParameter(e,t={}){let{tolerance:n=5}=t,r=this.getLUT(),s=[],i=0;for(let o=0,c;o<r.length;o++)c=r[o],h.dist(c,e)<n&&(s.push(c),i+=o/r.length);return s.length===0?null:{t:i/s.length,hits:s,tolerance:n}},project(e){let t=this.getLUT(),n=t.length-1,r=h.closest(t,e),s=r.mpos,i=(s-1)/n,o=(s+1)/n,c=.1/n,u=r.mdist,l=i,f=l,a;u+=1;for(let p;l<o+c;l+=c)a=this.compute(l),p=h.dist(e,a),p<u&&(u=p,f=l);return f=f<0?0:f>1?1:f,a=this.compute(f),a.t=f,a.d=u,a},bbox(){let e=this.extrema(),t={};return this.dims.forEach(function(n){t[n]=h.getminmax(this,n,e[n])}.bind(this)),t},overlaps(e){let t=this.bbox(),n=e.bbox();return h.bboxoverlap(t,n)},extrema(){let e={},t=[];return this.dims.forEach(function(n){let r=function(i){return i[n]},s=this.dpoints[0].map(r);e[n]=h.droots(s),this.order===3&&(s=this.dpoints[1].map(r),e[n]=e[n].concat(h.droots(s))),e[n]=e[n].filter(function(i){return i>=0&&i<=1}),t=t.concat(e[n].sort(h.numberSort))}.bind(this)),e.values=t.sort(h.numberSort).filter(function(n,r){return t.indexOf(n)===r}),e},sample(e=10){if(e<2)throw new L("Sample count must be at least 2",J.INVALID_PARAMETER,{count:e});return Array.from({length:e},(t,n)=>this.get(n/(e-1)))},closestPoint(e){let t=this.project(e);return{point:{x:t.x,y:t.y,...t.z?{z:t.z}:{}},t:t.t,distance:t.d}},getInfo(){let e={1:"linear",2:"quadratic",3:"cubic"};return{order:this.order,type:e[this.order]||`order-${this.order}`,is3D:!!this._3d,isLinear:!!this._linear,pointCount:this.points.length,length:this.length(),bbox:this.bbox(),extrema:this.extrema()}},contains(e,t={}){let{tolerance:n=1}=t;return this.findParameter(e,{tolerance:n})!==null}};var Ft={align(){let e=this.points;return new this.constructor(h.align(e,{p1:e[0],p2:e[e.length-1]}))},normal(e){return this._3d?this.__normal3(e):this.__normal2(e)},__normal2(e){let t=this.derivative(e),n=E(t.x*t.x+t.y*t.y);return{t:e,x:-t.y/n,y:t.x/n}},__normal3(e){let t=this.derivative(e),n=this.derivative(e+.01),r=E(t.x*t.x+t.y*t.y+t.z*t.z),s=E(n.x*n.x+n.y*n.y+n.z*n.z);t.x/=r,t.y/=r,t.z/=r,n.x/=s,n.y/=s,n.z/=s;let i={x:n.y*t.z-n.z*t.y,y:n.z*t.x-n.x*t.z,z:n.x*t.y-n.y*t.x},o=E(i.x*i.x+i.y*i.y+i.z*i.z);i.x/=o,i.y/=o,i.z/=o;let c=[i.x*i.x,i.x*i.y-i.z,i.x*i.z+i.y,i.x*i.y+i.z,i.y*i.y,i.y*i.z-i.x,i.x*i.z-i.y,i.y*i.z+i.x,i.z*i.z];return{t:e,x:c[0]*t.x+c[1]*t.y+c[2]*t.z,y:c[3]*t.x+c[4]*t.y+c[5]*t.z,z:c[6]*t.x+c[7]*t.y+c[8]*t.z}},hull(e){let t=this.points,n=[],r=[],s=0;for(r[s++]=t[0],r[s++]=t[1],r[s++]=t[2],this.order===3&&(r[s++]=t[3]);t.length>1;){n=[];for(let i=0,o,c=t.length-1;i<c;i++)o=h.lerp(e,t[i],t[i+1]),r[s++]=o,n.push(o);t=n}return r},split(e,t){if(e===0&&!!t)return this.split(t).left;if(t===1)return this.split(e).right;let n=this.hull(e),r={left:this.order===2?new this.constructor([n[0],n[3],n[5]]):new this.constructor([n[0],n[4],n[7],n[9]]),right:this.order===2?new this.constructor([n[5],n[4],n[2]]):new this.constructor([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=h.map(0,0,1,this._t1,this._t2),r.left._t2=h.map(e,0,1,this._t1,this._t2),r.right._t1=h.map(e,0,1,this._t1,this._t2),r.right._t2=h.map(1,0,1,this._t1,this._t2),t?(t=h.map(t,e,1,0,1),r.right.split(t).left):r},simple(){if(this.order===3){let r=h.angle(this.points[0],this.points[3],this.points[1]),s=h.angle(this.points[0],this.points[3],this.points[2]);if(r>0&&s<0||r<0&&s>0)return!1}let e=this.normal(0),t=this.normal(1),n=e.x*t.x+e.y*t.y;return this._3d&&(n+=e.z*t.z),O($(n))<Q/3},reduce(){let e,t=0,n=0,r=.01,s,i=[],o=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),t=c[0],e=1;e<c.length;e++)n=c[e],s=this.split(t,n),s._t1=t,s._t2=n,i.push(s),t=n;return i.forEach(function(u){for(t=0,n=0;n<=1;)for(n=t+r;n<=1+r;n+=r)if(s=u.split(t,n),!s.simple()){if(n-=r,O(t-n)<r)return[];s=u.split(t,n),s._t1=h.map(t,0,1,u._t1,u._t2),s._t2=h.map(n,0,1,u._t1,u._t2),o.push(s),t=n;break}t<1&&(s=u.split(t,1),s._t1=h.map(t,0,1,u._t1,u._t2),s._t2=u._t2,o.push(s))}),o}};var Vt={offsetPoint(e,t){if(e<0||e>1)throw new L(`Parameter t must be between 0 and 1, got ${e}`,J.OUT_OF_RANGE,{t:e,validRange:[0,1]});let n=this.get(e),r=this.normal(e),s={point:{x:n.x+r.x*t,y:n.y+r.y*t},normal:r,curve:n,t:e,distance:t};return this._3d&&(s.point.z=n.z+r.z*t),s},offsetCurve(e){if(this._linear){let t=this.normal(0),n=this.points.map(function(r){let s={x:r.x+e*t.x,y:r.y+e*t.y};return r.z&&t.z&&(s.z=r.z+e*t.z),s});return[new this.constructor(n)]}return this.reduce().map(function(t){return t._linear?t.offsetCurve(e)[0]:t.scale(e)})},offset(e,t){return typeof t<"u"?this.offsetPoint(e,t):this.offsetCurve(e)},translate(e,t,n){n=typeof n=="number"?n:t;let r=this.order,s=this.points.map((i,o)=>(1-o/r)*t+o/r*n);return new this.constructor(this.points.map((i,o)=>({x:i.x+e.x*s[o],y:i.y+e.y*s[o]})))},scale(e){let t=this.order,n=!1;if(typeof e=="function"&&(n=e),n&&t===2)return this.raise().scale(n);let r=this.clockwise,s=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);let i=n?n(0):e,o=n?n(1):e,c=[this.offsetPoint(0,10),this.offsetPoint(1,10)],u=[],l=h.lli4(c[0].point,c[0].curve,c[1].point,c[1].curve);if(!l)throw new L("Cannot scale this curve",J.INVALID_CURVE,{suggestion:"Try reducing the curve first using reduce()",curve:this});return[0,1].forEach(function(f){let a=u[f*t]=h.copy(s[f*t]);a.x+=(f?o:i)*c[f].normal.x,a.y+=(f?o:i)*c[f].normal.y}),n?([0,1].forEach(function(f){if(!(t===2&&!!f)){var a=s[f+1],p={x:a.x-l.x,y:a.y-l.y},m=n?n((f+1)/t):e;n&&!r&&(m=-m);var g=E(p.x*p.x+p.y*p.y);p.x/=g,p.y/=g,u[f+1]={x:a.x+m*p.x,y:a.y+m*p.y}}}),new this.constructor(u)):([0,1].forEach(f=>{if(t===2&&!!f)return;let a=u[f*t],p=this.derivative(f),m={x:a.x+p.x,y:a.y+p.y};u[f+1]=h.lli4(a,m,l,s[f+1])}),new this.constructor(u))},outline(e,t,n,r){if(t=t===void 0?e:t,this._linear){let y=this.normal(0),d=this.points[0],b=this.points[this.points.length-1],x,z,v;n===void 0&&(n=e,r=t),x={x:d.x+y.x*e,y:d.y+y.y*e},v={x:b.x+y.x*n,y:b.y+y.y*n},z={x:(x.x+v.x)/2,y:(x.y+v.y)/2};let M=[x,z,v];x={x:d.x-y.x*t,y:d.y-y.y*t},v={x:b.x-y.x*r,y:b.y-y.y*r},z={x:(x.x+v.x)/2,y:(x.y+v.y)/2};let N=[v,z,x],q=h.makeline(N[2],M[0]),K=h.makeline(M[2],N[0]),S=[q,new this.constructor(M),K,new this.constructor(N)];return new U(S)}let s=this.reduce(),i=s.length,o=[],c=[],u,l=0,f=this.length(),a=typeof n<"u"&&typeof r<"u";function p(y,d,b,x,z){return function(v){let M=x/b,N=(x+z)/b,q=d-y;return h.map(v,0,1,y+M*q,y+N*q)}}s.forEach(function(y){let d=y.length();a?(o.push(y.scale(p(e,n,f,l,d))),c.push(y.scale(p(-t,-r,f,l,d)))):(o.push(y.scale(e)),c.push(y.scale(-t))),l+=d}),c=c.map(function(y){return u=y.points,u[3]?y.points=[u[3],u[2],u[1],u[0]]:y.points=[u[2],u[1],u[0]],y}).reverse();let m=o[0].points[0],g=o[i-1].points[o[i-1].points.length-1],A=c[i-1].points[c[i-1].points.length-1],C=c[0].points[0],w=h.makeline(A,m),I=h.makeline(g,C),_=[w].concat(o).concat([I]).concat(c);return new U(_)},outlineshapes(e,t,n){t=t||e;let r=this.outline(e,t).curves,s=[];for(let i=1,o=r.length;i<o/2;i++){let c=h.makeshape(r[i],r[o-i],n);c.startcap.virtual=i>1,c.endcap.virtual=i<o/2-1,s.push(c)}return s}};var Gt={intersects(e,t){return e?e.p1&&e.p2?this.lineIntersects(e):((e.constructor.name==="Bezier"||e instanceof this.constructor)&&(e=e.reduce()),this.curveintersects(this.reduce(),e,t)):this.selfintersects(t)},lineIntersects(e){let t=ut(e.p1.x,e.p2.x),n=ut(e.p1.y,e.p2.y),r=ft(e.p1.x,e.p2.x),s=ft(e.p1.y,e.p2.y);return h.roots(this.points,e).filter(i=>{var o=this.get(i);return h.between(o.x,t,r)&&h.between(o.y,n,s)})},selfintersects(e){let t=this.reduce(),n=t.length-2,r=[];for(let s=0,i,o,c;s<n;s++)o=t.slice(s,s+1),c=t.slice(s+2),i=this.curveintersects(o,c,e),r.push(...i);return r},curveintersects(e,t,n){let r=[];e.forEach(function(i){t.forEach(function(o){i.overlaps(o)&&r.push({left:i,right:o})})});let s=[];return r.forEach(function(i){let o=h.pairiteration(i.left,i.right,n);o.length>0&&(s=s.concat(o))}),s}};var Jt={arcs(e=.5){return this._iterate(e,[])},_error(e,t,n,r){let s=(r-n)/4,i=this.get(n+s),o=this.get(r-s),c=h.dist(e,t),u=h.dist(e,i),l=h.dist(e,o);return O(u-c)+O(l-c)},_iterate(e,t){let n=0,r=1,s;do{s=0,r=1;let i=this.get(n),o,c,u,l,f=!1,a=!1,p,m=r,g=1,A=0;do if(a=f,l=u,m=(n+r)/2,A++,o=this.get(m),c=this.get(r),u=h.getccenter(i,o,c),u.interval={start:n,end:r},f=this._error(u,i,n,r)<=e,p=a&&!f,p||(g=r),f){if(r>=1){if(u.interval.end=g=1,l=u,r>1){let w={x:u.x+u.r*R(u.e),y:u.y+u.r*P(u.e)};u.e+=h.angle({x:u.x,y:u.y},w,this.get(1))}break}r=r+(r-n)/2}else r=m;while(!p&&s++<100);if(s>=100)break;l=l||u,t.push(l),n=g}while(r<1);return t}};var D=class extends ct{constructor(...t){super(...t)}};Object.assign(D.prototype,St);Object.assign(D.prototype,Ft);Object.assign(D.prototype,Vt);Object.assign(D.prototype,Gt);Object.assign(D.prototype,Jt);Lt(D);})();
